name: Update CHANGELOG on PR merge

on:
    pull_request:
        types: [closed]
        branches:
            - main

jobs:
    update-changelog:
        runs-on: ubuntu-latest
        permissions:
            contents: write
        
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                fetch-depth: 0
                ref: $({ github.event.pull_request.base.ref })
            
            - name: Get changed files
              id: changed-files
              run: |
                git fetch origin pull/${{ github.event.pull_request.number }}/head:pr-${{ github.event.pull_request.number }}
                CHANGED_FILES=$(git diff --name-only origin/${{ github.event.pull_request.base.sha }} pr-${{ github.event.pull_request.number }})
            
            - name: Update CHANGELOG.md
              run: |
                echo "- PR #${{ github.event.pull_request.number }} merged by ${{ github.event.pull_request.number }} on $(date +'%Y-%m-%d')" >> CHANGELOG.md
            
            - name: Commit and push changes
              run: |
                git config user.name "github-actions"
                git config user.email "github-actions@github.com"
                git add CHANGELOG.md
                git commit -m "Update CHANGELOG.md for PR #${{ github.event.pull_request.number }}"
                git push

                